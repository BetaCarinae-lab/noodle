#(
    Apparently it's "hard" to code snake
    this is a placeholder till i make a better version
)

number window_w is 400
number window_h is 400

<INIT_WINDOW#(400, 400, "window")>
mut number W is 10
mut number H is 10

mut number x is 0
mut number y is 0

mut boolean inApple is false
mut string dir is "down"
mut number score is 0

mut number apple_x is <MATH#("round", <window_h> * <RAND#()>)>
mut number apple_y is <MATH#("round", <window_w> * <RAND#()>)>

fn handle_input() {
    if(<IS_KEY_DOWN#("W")>) {
        dir is "up"
    }
    if(<IS_KEY_DOWN#("S")>) {
        dir is "down"
    }
    if(<IS_KEY_DOWN#("A")>) {
        dir is "left"
    }
    if(<IS_KEY_DOWN#("D")>) {
        dir is "right"
    }
    if(<IS_KEY_DOWN#("SPACE")>) {
        writeLn(<dir>)
    }
}

fn handle_movement() {
    if(<dir> == "up") {
        y is <y> - 1
    }
    if(<dir> == "down") {
        y is <y> + 1
    }
    if(<dir> == "left") {
        x is <x> - 1
    }
    if(<dir> == "right") {
        x is <x> + 1
    }
}

fn award_points() {
    if(<PointInRect(<apple_x>, <apple_y>, <W>, <H>, <x>, <y>)>) {
        score is <score> + 1
    }
}

fn PointInRect(x: number, y: number, w: number, h: number, point_x: number, point_y: number) {
  if(<point_x> >= <x> && <point_x> <= <x> + <w> && <point_y> >= <y> && <point_y> <= <y> + <h>) {
    output(true)
  } else {
    output(false)
  }
}


while(!<WINDOW_SHOULD_CLOSE#()>) {

    <BEGIN_DRAWING#()>
    <CLEAR_BACKGROUND#(0,0,0)>

    <RECTANGLE#(<apple_x>, <apple_y>, <W>, <H>, 255, 0, 0, 255)>
    <RECTANGLE#(<x>, <y>, <W>, <H>, 255, 255, 255, 255)>

    <TEXT#("SCORE: " + <score>, 0, 0, 20, 255, 255, 255, 255)>
    <TEXT#("X: " + <x>, 0, 20, 20, 255, 255, 255, 255)>
    <TEXT#("Y: " + <y>, 0, 40, 20, 255, 255, 255, 255)>

    if(<x> >= <apple_x> && <x> <= <apple_x> + <W> && <y> >= <apple_y> && <y> <= <apple_y> + <H> && !<inApple>) {
        score is <score> + 1
        apple_x is <MATH#("round", <window_w> * <RAND#()>)>
    } else {
        #(do nothing)
    }

    <handle_input()>
    <handle_movement()>

    <STOP_DRAWING#()>
}

<CLOSE_WINDOW#()>