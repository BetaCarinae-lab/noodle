NOODLE {
  Program     = Statement* ";"?
  Statement   = Print 
          | VarCreate
          | VarAssign
          | Array
          | Template
          | Fn
          | If
          | Loop
          | Delete
          | Comment
          | TryCatch
          | Exit
          | Return
          | End
          | Expr

  Print = "writeLn" "(" Expr ")"

  Expr = LogicalOr

  LogicalOr
    = LogicalOr "||" LogicalAnd  --or
    | LogicalAnd

  LogicalAnd
    = LogicalAnd "&&" LogicalXor   --and
    | LogicalXor

  LogicalXor
    = LogicalXor "::" LogicalAnd --xor
    | Equality

  Equality
    = Equality "==" Comparison   --eq
    | Equality "===" Comparison  --deepEq
    | Comparison

  Comparison
    = Comparison ">" Additive    --greater
    | Comparison "<" Additive    --less
    | Comparison ">=" Additive   --greatereq
    | Comparison "<=" Additive   --lesseq
    | Additive

  Additive
    = Additive "+" Multiplicative --add
    | Additive "-" Multiplicative --minus
    | Multiplicative

  Multiplicative
    = Multiplicative "*" Unary   --times
    | Multiplicative "/" Unary   --divide
    | Unary

  Unary
    = "!" Unary                  --not
    | "-" Unary                  --negate
    | Postfix

  Postfix
    = ident "++"                 --increment
    | ident "--"                 --decrement
    | Primary

  Primary
    = "(" Expr ")"               --parens
    | number
    | string
    | Query
    | ArrayAccess
    | VarGet
    | Exists
    | FnCall
    | As
    | MethodCall
    | RefResolve
    | ObjectPropertyAccess
    | TemplateConstruction
    | True
    | False
    | Reference


  Fn = "persistant"? "fn" ident ParameterList FuncBody
  
  ParameterList = "(" ListOf<Parameter, ","> ")"
  
  Parameter = "mut"? ident ":" Type

  As = Expr "as" Type

  Delete = "delete" ident

  ExitValues = "success" | "failure"

  Exit = "exit" ExitValues
  
  Array = "[" listOf<Statement, ","> "]"

  End = "end"

  Comment = "#" "(" (~")" any)* ")"
  
  True = "true" | "yes" | "yeah"
  False = "false" | "no" | "nah"
  
  ArrayAccess = "<" ident "at" Statement ">"
  
  StatementParameterList = "(" ListOf<Statement, ","> ")"

  FnCall = "<" ident StatementParameterList ">"

  Mut = "mut"?

  VarCreate = Mut "persistant"? "strict"? Type ident "is" Statement

  VarAssign = (ident | RefResolve) "is" Statement
  
  Property = Mut "prop" ident "is" Type ","
  
  TemplateBody = "{"  (~"}" Property | Method)* "}"
  
  Template = "persistant"? "template" ident TemplateBody
   
  TemplateConstruction = ident ObjectBody
  
  ObjectBody = "{" (ident ":" Statement ",")* "}"
  
  Method = "method" ident "is" ParameterList FuncBody
  
  MethodCall = "<" ObjectProperty StatementParameterList ">"
  
  ObjectProperty = ident ("." ident)+
  
  ObjectPropertyAccess = "<" ObjectProperty ">"
  
  If = "if" "(" Expr ")" FuncBody "else"? FuncBody?

  Query = "query" "(" Expr ")"

  VarGet = "<" (ident | RefResolve) ">"
  
  Reference = "&" ident

  Type = "any" | "number" | "string" | "fn" | "array" | "object" | "reference" | "boolean"

  FuncBody = "{" Statement+ "}"
  
  RefResolve = "|" ident "|"

  FnType = "async" | "pub" | "local"
  
  Exists = ident "exists"
  
  TryCatch = "try" FuncBody "catch" "(" ident? ")" FuncBody
  
  number = digit+ | "inf"
  
  Return = "output" "(" Statement ")"
  
  Loop = "loop" Expr FuncBody

  string = "\"" (~"\"" any)* "\""

  ident = letter idchar*

  idchar = "_" | letter | number
}